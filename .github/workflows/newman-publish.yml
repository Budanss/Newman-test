name: Run Newman Publish Report  # ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ workflow (Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚ÑÑ Ð²Ð¾ Ð²ÐºÐ»Ð°Ð´ÐºÐµ Actions)

on:
  schedule:
    - cron: '0 3 * * *'  # ÐÐ²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ: ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 03:00 UTC
  push:
    branches: [ main ]   # Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸ push Ð² Ð²ÐµÑ‚ÐºÑƒ main
  workflow_dispatch:     # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· ÐºÐ½Ð¾Ð¿ÐºÑƒ "Run workflow"

jobs:
  newman:                # Ð˜Ð¼Ñ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð»ÑŽÐ±Ð¾Ðµ)
    runs-on: ubuntu-latest   # Ð“Ð´Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ (Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð°Ñ Ubuntu-Ð¼Ð°ÑˆÐ¸Ð½Ð°)

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        # Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ Ñ‚Ð²Ð¾Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð² workflow, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½ "Ð²Ð¸Ð´ÐµÐ»" Ñ‚Ð²Ð¾Ð¸ Ñ„Ð°Ð¹Ð»Ñ‹

      - name: Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
        # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ Node.js, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Newman

      - name: Install Newman and reporter
        run: |
          npm install -g newman
          npm install -g newman-reporter-htmlextra
        # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ Newman Ð¸ Ñ€ÐµÐ¿Ð¾Ñ€Ñ‚Ñ‘Ñ€ Ð´Ð»Ñ HTML-Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°

      - name: Create reports directory
        run: mkdir -p docs
        # Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ñ‚ Ð¿Ð°Ð¿ÐºÑƒ reports Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°

      - name: Run Newman tests and export report
        run: |
          newman run collections/newOrder.json \
          -e environment/Dev-environment.json \
          -r cli,htmlextra \
          --reporter-htmlextra-export docs/report.html
        continue-on-error: true
        # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ:
        # - `collections/createOrder.json` â€” Ð¿ÑƒÑ‚ÑŒ Ðº Ñ‚Ð²Ð¾ÐµÐ¹ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸
        # - `-e environment/Dev-environment.json` â€” Ð¿ÑƒÑ‚ÑŒ Ðº Ñ„Ð°Ð¹Ð»Ñƒ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ, ÐµÑÐ»Ð¸ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½)
        # - `-r cli,htmlextra` â€” Ð»Ð¾Ð³ Ð² Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» + HTML-Ð¾Ñ‚Ñ‡Ñ‘Ñ‚
        # - `--reporter-htmlextra-export` â€” Ð¿ÑƒÑ‚ÑŒ, ÐºÑƒÐ´Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ HTML
        # - `continue-on-error: true` â€” Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸

      - name: ðŸ” Debug â€” list docs folder
        run: ls -l docs

      - name: Create .nojekyll file
        run: echo "" > docs/.nojekyll

      - name: Commit docs to main branch
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git pull origin main
          git add docs/report.html docs/.nojekyll
          git commit -m "ðŸ“„ Update report [skip ci]" || echo "No changes to commit"
          git push origin main
